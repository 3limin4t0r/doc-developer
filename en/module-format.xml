<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
<!-- $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $ -->

<chapter>
    <title>Module Format</title>

    <section id="core-modules">
        <title>Core Modules</title>
        <xi:include href="module-format/log.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
        <xi:include href="module-format/outputfilter.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
        <xi:include href="module-format/stats.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    </section>

    <section id="frontend-modules">
        <title>Frontend Modules</title>
        <xi:include href="module-format/dashboard.xml" xmlns:xi="http://www.w3.org/2001/XInclude" />
    </section>

    <section id="old-module-description">
        <title>Old Module Descriptions</title>
        <para>Please remove these old sections if newer ones were created.</para>

    <section id="module-auth">
        <title>Auth Module</title>
        <para>
There are several agent authentication modules (DB, LDAP and HTTPBasicAuth)
which come with the OTRS framework. It is also possible to develop your own
authentication modules. The agent authentication modules are located under
Kernel/System/Auth/*.pm. For more information about their configuration see the admin manual.
Following, there is an example of a simple agent auth module. Save it under Kernel/System/Auth/Simple.pm.
You just need 3 functions: new(), GetOption() and Auth(). Return the uid, then the
authentication is ok.
        </para>
        <para>Format:
        <programlisting><![CDATA[
# --
# Kernel/System/Auth/Simple.pm - provides the simple authentication
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::System::Auth::Simple;

use strict;
use warnings;

sub new {
    my ( $Type, %Param ) = @_;
    [...]
    return $Self;
}
sub GetOption {
    my ( $Self, %Param ) = @_;
    # return option
    return (PreAuth => 0);
}
sub Auth {
    my ( $Self, %Param ) = @_;
    [...]
    if ($Authentication) {
        return $Param{User};
    }
    else {
        return;
    }
}
        ]]></programlisting>
        </para>
    </section>
    <section id="module-notify">
        <title>Notify Module</title>
        <para>
With agent notification modules you can inform agents about new information. A
normal navigation looks like the following screen shot.
        </para>
        <para>
            <screenshot>
                <graphic srccredit="" scale="60" fileref="screenshots/notify-screen1.png"></graphic>
            </screenshot>
        </para>
        <para>
With this examplary module you can do something like the following.
        </para>
        <para>
            <screenshot>
                <graphic srccredit="" scale="60" fileref="screenshots/notify-screen2.png"></graphic>
            </screenshot>
        </para>
        <para>
Format:
        <programlisting><![CDATA[
# --
# Kernel/Output/HTML/NotificationMotd.pm - message of the day
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::Output::HTML::NotificationMotd;

use strict;
use warnings;

# --
sub new {
    my ( $Type, %Param ) = @_;
    [...]
    return $Self;
}
# --
sub Run {
    my ( $Self, %Param ) = @_;
    return $Self->{LayoutObject}->Notify(Info =>  'Some daily news!' );
}
# --
1;
        ]]></programlisting>
        </para>
        <para>
To use this module add the following to the <filename>Kernel/Config.pm</filename>
and restart your webserver (if you use mod_perl).
        <programlisting><![CDATA[
# Frontend::NotifyModule - module name (50-Motd)
$Self->{'Frontend::NotifyModule'}->{'50-Motd'} = {
    Module => 'Kernel::Output::HTML::NotificationMotd',
};
        ]]></programlisting>
        </para>
    </section>
    <section id="module-navigation">
        <title>Navigation Module</title>
        <para>
In this module layer you can create dynamic navigation bar items with
dynamic content (Name and Description). Navigation Module are located under Kernel/Output/HTML/NavBar*.pm.
        </para>
        <para>
Format:
        <programlisting><![CDATA[
# --
# Kernel/Output/HTML/NavBarABC.pm - shows a navbar item dynamicaly
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::Output::HTML::NavBarABC;

use strict;
use warnings;

# --
sub new {
    my ( $Type, %Param ) = @_;
    [...]
    return $Self;
}
# --
sub Run {
    my ( $Self, %Param ) = @_;
    my %Return = ();
    $Return{'0999989'} = {
        Block       => 'ItemPersonal',
        Description => 'Some Desctipton',
        Name        => 'Text',
        Image       => 'new-message.png',
        Link        => 'Action=AgentMailbox&amp;Subaction=New',
        AccessKey   => 'j',
    };
    return %Return;
}
# --
1;
        ]]></programlisting>
        </para>
        <para>
To use this module add the following code to the Kernel/Config.pm and restart
your webserver (if you use mod_perl).
        <programlisting><![CDATA[
[Kernel/Config.pm]
# agent interface notification module
$Self->{'Frontend::NavBarModule'}->{'99-ABC'} = {
    Module => 'Kernel::Output::HTML::NavBarABC',
};
        ]]></programlisting>
        </para>
    </section>
    <section id="old-frontend-modules">
        <title>Frontend Modules</title>
        <para>
Frontend Modules are located under  "$OTRS_HOME/Kernel/Modules/*.pm". There
are two public functions in there - new() and run() - which are accessed from the
Frontend Handle (e. g. index.pl). "new()" is used to create a frontend
module object. The Frontend Handle provides the used frontend module with the basic framework object.
These are, for example: ParamObject (to get formular params), DBObject
(to use existing database connects), LayoutObject (to use templates and other
html layout functions), ConfigObject (to access config settings), LogObject
(to use the framework log system), UserObject (to get the user functions from
the current user), GroupObject (to get the group functions), MainObject (to get main functions
like 'Require') and EncodeObject (for the charset encoding).
        </para>
        <para>
For more information on core modules see
<ulink url="http://dev.otrs.org/">http://dev.otrs.org/</ulink>
        </para>
        <para>
Format:
        <programlisting><![CDATA[
# --
# Kernel/Modules/AgentTest.pm - message of the day
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::Modules::AgentTest;

use strict;
use warnings;

use vars qw(@ISA $VERSION);
$VERSION = qw($Revision: 1.37 $) [1];

# --
sub new {
    my ( $Type, %Param ) = @_;
    [...]
    return $Self;
}
# --
sub Run {
    my ( $Self, %Param ) = @_;
    [...]
    # ---------------------------------------------------------- #
    # add a new object (Note: dtl text 'New')
    # ---------------------------------------------------------- #
    if ($Self->{Subaction} eq 'Add') {
        my $Output   = '';
        my %Frontend = ();
        [...]
        # add add block
        $Self->{LayoutObject}->Block(
            Name => 'Add',
            Data => {%Param, %Frontend},
        );
        # build output
        $Output .= $Self->{LayoutObject}->Header(Area => 'Agent', Title => "Test");
        $Output .= $Self->{LayoutObject}->NavigationBar();
        $Output .= $Self->{LayoutObject}->Output(
            Data => {%Param, %Frontend},
            TemplateFile => 'AgentTest',
        );
        $Output .= $Self->{LayoutObject}->Footer();
        return $Output;
    }
    # ---------------------------------------------------------- #
    # show overview screen
    # ---------------------------------------------------------- #
    elsif ($Self->{Subaction} eq 'Overview') {
        # add overview block
        $Self->{LayoutObject}->Block(
            Name => 'Overview',
            Data => {%Param, %Frontend},
        );
        # build output
        $Output .= $Self->{LayoutObject}->Header(Area => 'Agent', Title => "Test");
        $Output .= $Self->{LayoutObject}->NavigationBar();
        $Output .= $Self->{LayoutObject}->Output(
            Data => {%Param, %Frontend},
            TemplateFile => 'AgentTest',
        );
        $Output .= $Self->{LayoutObject}->Footer();
        return $Output;
    }
    # ---------------------------------------------------------- #
    # show error screen
    # ---------------------------------------------------------- #
    return $Self->{LayoutObject}->ErrorScreen(Message => "Invalid Subaction process!");
}
# --
1;
        ]]></programlisting>
        </para>
        <para>
You also need a module registration for frontend modules. Define read
only groups with the "GroupRo" and read/write groups with the 'Group' param (see
table below for details). You can define navigation bar icons via the
"NavBar'"param, too (see table below for details).
        <programlisting><![CDATA[
[Kernel/Config.pm]
$Self->{'Frontend::Module'}->{'AgentTest'} = {
    Group => ['admin'],
    GroupRo => ['test', 'admin'],
    Description => 'A test Module',
    NavBarName => 'Ticket',
    NavBar => [
        {
            Description => 'Test Module',
            Name => 'Test',
            Image => 'stats.png',
            Link => 'Action=AgentTest',
            NavBar => 'Ticket',
            Prio => 85,
        },
    ],
};
        ]]></programlisting>
        </para>
        <para>
You can access this frontend module via http (browse) with the Action
param = Module or over the navigation bar.
        </para>
        <para>
            <ulink url="">http://localhost/otrs/index.pl?Action=AgentTest</ulink>
        </para>
        <para>
Description of Frontend::Module options:
        </para>
        <para>
        <informaltable>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Key</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Group</entry>
                        <entry>An ARRAY reference of rw groups of this module.</entry>
                    </row>
                    <row>
                        <entry>GroupRo</entry>
                        <entry>An ARRAY reference of ro groups of this module.</entry>
                    </row>
                    <row>
                        <entry>Description</entry>
                        <entry>Module description, just for internal use - not shown in the user interface.</entry>
                    </row>
                    <row>
                        <entry>NavBarName</entry>
                        <entry>NavBar context name of this module.</entry>
                    </row>
                </tbody>
            </tgroup>
        </informaltable>
        </para>
        <para>
Description of NavBar (icon points) options:
        </para>
        <para>
        <informaltable>
            <tgroup cols="2">
                <thead>
                    <row>
                        <entry>Key</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Description</entry>
                        <entry>The description of the icon which is shown in the navbar after the curser is pointed on it.</entry>
                    </row>
                    <row>
                        <entry>Name</entry>
                        <entry>The icon name shown in the navbar.</entry>
                    </row>
                    <row>
                        <entry>Image</entry>
                        <entry>The icon image shown in the navbar.</entry>
                    </row>
                    <row>
                        <entry>Link</entry>
                        <entry>The link behind the icon in the navbar.</entry>
                    </row>
                    <row>
                        <entry>NavBar</entry>
                        <entry>Only shown this icon in this NavBar context.</entry>
                    </row>
                    <row>
                        <entry>Prio</entry>
                        <entry>Sort prio of the icon in the navbar.</entry>
                    </row>
                </tbody>
            </tgroup>
        </informaltable>
        </para>
    </section>
    <section id="module-core">
        <title>Core Modules</title>
        <para>
Core modules are located under $OTRS_HOME/Kernel/System/*. This layer is for
the logical work. The modules are used to handle system routines like "lock ticket"
and "create ticket". These modules  always need pod (Perl Documentation).
        </para>
        <para>
A few common core modules are: Log (Kernel::System::Log); Ticket
(Kernel::System::Ticket), Auth (Kernel::System::Auth), User (Kernel::System::User),
Email (Kernel::System::Email).
        </para>
        <para>
For more information on the core modules see
<ulink url="http://dev.otrs.org/">http://dev.otrs.org</ulink>
        </para>
        <para>
Format:
        </para>
        <para>
        <programlisting><![CDATA[
# --
# Kernel/System/Backend.pm - a core module
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::System::Backend;

use strict;
use warnings;

=head1 NAME

Kernel::System::Log - global log interface

=head1 SYNOPSIS

All log functions.

=head1 PUBLIC INTERFACE

=over 4

=item new()

create a backend object

use Kernel::Config;
use Kernel::System::Backend;

use vars qw(@ISA $VERSION);
$VERSION = qw($Revision: 1.37 $) [1];

my $ConfigObject = Kernel::Config->new();
my $BackendObject    = Kernel::System::Backend->new(ConfigObject => $ConfigObject);

=cut

sub new {
    my ( $Type, %Param ) = @_;
    [...]
    return $Self;
}

=item SomeMethodeA()

some info about the methode

$BackendObject->SomeMethodeA(ParamA => 'error', ParamB => "Need something!");

=cut

sub SomeMethodeA{
    my ( $Self, %Param ) = @_;
    [...]
    return 1;
}
1;

=head1 TERMS AND CONDITIONS

This software is part of the OTRS project (http://otrs.org/).

This software comes with ABSOLUTELY NO WARRANTY. For details, see
the enclosed file COPYING for license information (AGPL). If you
did not receive this file, see http://www.gnu.org/licenses/agpl.txt.

=head1 VERSION

$Revision: 1.37 $ $Date: 2010-05-10 15:49:41 $

=cut
        ]]></programlisting>
        </para>
    </section>
    <section id="module-customer-auth">
        <title>Customer Auth Module</title>
        <para>
The same as "Agent Auth Modules" but the module location is
<filename>Kernel/System/CustomerAuth/*.pm</filename>.
        </para>
    </section>
    <section id="module-customer-user">
        <title>Customer User Module</title>
        <para>
This module layer can be used as a bridge between your customer source
system and OTRS. Thus it is possible to use your customer data directly for
your data ware house (read only and read/write).
        </para>
        <para>
Format:
        </para>
        <para>
        <programlisting><![CDATA[
# --
# Kernel/System/CustomerUser/ABC.pm - a customer data backend
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::System::CustomerUser::ABD;

use strict;
use warnings;

use vars qw(@ISA $VERSION);
$VERSION = qw($Revision: 1.37 $) [1];

# --
sub new {
    my ( $Type, %Param ) = @_;
    [...]
    return $Self;
}
# --
sub CustomerName {
    [...]
    return $Name;
}
# --
sub CustomerSearch {
    [...]
    return %Result;
}
# --
sub CustomerUserList {
    [...]
    return %List;
}
# --
sub CustomerIDs {
    [...]
    return @CustomerIDs;
}
# --
sub CustomerUserDataGet {
    [...]
    return %Data;
}
# --
sub CustomerUserAdd {
    [...]
    return 1
}
# --
sub CustomerUserUpdate {
    [...]
    return 1;
}
# --
sub SetPassword {
    [...]
    return 1;
}
1;
        ]]></programlisting>
        </para>
        <para>
To use this module, see the admin manual.
        </para>
    </section>
    <section id="module-customer-navigation">
        <title>Customer Navigation Module</title>
        <para>
In this module layer you can create dynamic navigation bar items with
dynamic content (Name and Description).
        </para>
        <para>
The format is the same as in the Navigation Module.
        </para>
        <para>
Just the config setting key is different. To use this module, add the following
to the Kernel/Config.pm and restart your webserver (if you use mod_perl).
        </para>
        <para>
        <programlisting><![CDATA[
[Kernel/Config.pm]
# customer notifiacation module
$Self->{'CustomerFrontend::NavBarModule'}->{'99-ABC'} = {
    Module => 'Kernel::Output::HTML::NavBarABC',
};
        ]]></programlisting>
        </para>
    </section>
    <section id="old-module-stats">
        <title>Stats Module</title>
        <para>
There are two different types of internal stats modules - dynamic and static
        </para>
        <section id="dynamic-stats">
            <title>Dynamic stats</title>
            <para>
If you create a dynamic stats file, you can configurate your own statistics via
the web frontend.
            </para>
        <para>
The following functions are required (or optional) to get a functional script.
        <itemizedlist mark="round" >
            <listitem>
                <para>sub new</para>
                <para>to generate a new instance</para>
            </listitem>
            <listitem>
                <para>sub GetObjectName</para>
                <para>gives the name of this dynamic stats module to the web frontend.</para>
            </listitem>
            <listitem>
                <para>sub GetObjectAttributes</para>
                <para>generates an array with all possible elements of this dynamic stats module.</para>
            </listitem>
            <listitem>
                <para>sub GetStatElement</para>
                <para>
provides the content of a cell. Required if you do not use the function GetStatTable().
For example, have a look at Kernel/System/Stats/Dynamic/Ticket.pm.
                </para>
            </listitem>
            <listitem>
                <para>sub GetStatTable</para>
                <para>
provides the content of a table. Required if you do not use the function GetStatElement().
For example, have a look at Kernel/System/Stats/Dynamic/TicketList.pm.
                </para>
            </listitem>
            <listitem>
                <para>sub ExportWrapper</para>
                <para>converts the internal stats xml into a commonly usable format. For example 'queue id' into 'queue name'.</para>
            </listitem>
            <listitem>
                <para>sub ImportWrapper</para>
                <para>undoes the changes of the ExportWrapper during stats import.</para>
            </listitem>
            <listitem>
                <para>sub GetHeaderLine</para>
                <para>provides a individual sorted header line. Optional. Only if needed.</para>
            </listitem>
        </itemizedlist>
        </para>
        <para>
For example, have a look at
Kernel/System/Stats/Dynamic/Ticket.pm:
        </para>
        </section>
        <section id="static-stats">
            <title>Static stats</title>
        <para>
A static stats module is easy to make - you just need two functions.
Param() to get all usable params for the stats and Run() to return the stats result.
        </para>
        <para>
Kernel/System/Stats/Static/SomeExampleStats.pm:
        </para>
        <para>
        <programlisting><![CDATA[
# --
# Kernel/System/Stats/Static/SomeExampleStats.pm - stats module
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::System::Stats::Static::SomeExampleStats;

use strict;
use warnings;

use vars qw(@ISA $VERSION);
$VERSION = qw($Revision: 1.37 $) [1];

sub new {
    my ( $Type, %Param ) = @_;

    # allocate new hash for object
    my $Self = { %Param };
    bless( $Self, $Type );

    # check all needed objects
    for (qw(ConfigObject EncodeObject LogObject DBObject)) {
        die "Got no $_" if ( !$Self->{$_} );
    }

    return $Self;
}

sub Param {
    my $Self = shift;

    # get current time
    my ($s,$m,$h, $D,$M,$Y) = $Self->{TimeObject}->SystemTime2Date(
        SystemTime => $Self->{TimeObject}->SystemTime(),
    );
    # get one month before
    my $SelectedYear  = $M == 1 ? $Y - 1 : $Y;
    my $SelectedMonth = $M == 1 ? 12     : $M - 1;

    # create possible time selections
    my %Year = map { $_ => $_; } ( $Y - 10 .. $Y );
    my %Month = map { $_ => sprintf( "%02d", $_ ); } ( 1 .. 12 );

    my @Params = (
        {
            Frontend => 'Year',
            Name => 'Year',
            Multiple => 0,
            Size => 0,
            SelectedID => $SelectedYear,
            Data => {
                %Year,
            },
        },
        {
            Frontend => 'Month',
            Name => 'Month',
            Multiple => 0,
            Size => 0,
            SelectedID => $SelectedMonth,
            Data => {
                %Month,
            },
        },
    );
    return @Params;
}

sub Run {
    my ( $Self, %Param ) = @_;

    my $Title = "$Param{Year}-$Param{Month}";

    my @HeadData = ('Col A', 'Col B', 'Col C');

    my @Data = (
        [1, 4, 7],
        [6, 1, 4],
        [9, 4, 6],
    );

    return ([$Title],[@HeadData], @Data);
}

1;
        ]]></programlisting>
        </para>


        </section>
        <section id="stats-using-old-stats" >
            <title>Using old static stats</title>

            <para>
Standard OTRS versions 1.3 and 2.0 already facilitated the generation of stats.
Various stats for OTRS versions 1.3 and 2.0 which have been specially
developed to meet customers' requirements can be used in more recent versions too.
            </para>

            <para>
The files must merely be moved from the
<filename>Kernel/System/Stats/</filename> path to
<filename>Kernel/System/Stats/Static/</filename>. Additionally
the package name of the respective script must be amended by
"::Static".
            </para>

            <para>
The following example shows how the first path is amended.
            </para>

            <para>
                <programlisting><![CDATA[
    package Kernel::System::Stats::AccountedTime;
                ]]></programlisting>
            </para>
            <para>
                <programlisting><![CDATA[
    package Kernel::System::Stats::Static::AccountedTime;
                ]]></programlisting>
            </para>
        </section>
    </section>
    <section id="ticket-modules">
        <title>Ticket Modules</title>
        <section id="ticket-number-module">
            <title>Ticket Number Module</title>
            <para>
If you want to create your own ticket number format, just create your own ticket
number module. These modules are located under "Kernel/System/Ticket/Number/*.pm".
For default modules see the admin manual. You just need 2 functions:
CreateTicketNr() and GetTNByString():
            </para>
            <para>
Format:
            </para>
            <para>
            <programlisting><![CDATA[
# --
# Ticket/Number/Simple.pm - a ticket number auto increment generator
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::System::Ticket::Number::Simple;

use strict;
use warnings;

use vars qw(@ISA $VERSION);
$VERSION = qw($Revision: 1.37 $) [1];

sub CreateTicketNr {
    my $Self = shift;
    my $JumpCounter = shift || 0;
    # get needed config options
    [...]
    return $Tn;
}
# --
sub GetTNByString {
    my $Self = shift;
    my $String = shift || return;
    [...]
    return $Tn;
}
1;
            ]]></programlisting>
            </para>
        </section>
        <section id="ticket-postmaster-module">
            <title>Ticket PostMaster Module</title>
            <para>
PostMaster modules are used during the PostMaster process.
There are two kinds of PostMaster modules. PostMasterPre (used after parsing an email)
and PostMasterPost (used after an email is processed and in the database) modules.
            </para>
            <para>
If you want to create your own postmaster filter, just create your own module.
These modules are located under "Kernel/System/PostMaster/Filter/*.pm".
For default modules see the admin manual. You just need two functions:
new() and Run():
            </para>
            <para>
The following is an examplary module to match emails and set X-OTRS-Headers
(see doc/X-OTRS-Headers.txt for more info).
            </para>
            <para>
Kernel/Config.pm:
            </para>
            <para>
            <programlisting><![CDATA[
# Job Name: 1-Match
# (block/ignore all spam email with From: noreply@)
$Self->{'PostMaster::PreFilterModule'}->{'1-Example'} = {
    Module => 'Kernel::System::PostMaster::Filter::Example',
    Match => {
        From => 'noreply@',
    },
    Set => {
        'X-OTRS-Ignore' => 'yes',
    },
};
            ]]></programlisting>
            </para>
            <para>
Format:
            </para>
            <para>
            <programlisting><![CDATA[
# --
# Kernel/System/PostMaster/Filter/Example.pm - a postmaster filter
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::System::PostMaster::Filter::Example;

use strict;
use warnings;

use vars qw(@ISA $VERSION);
$VERSION = qw($Revision: 1.37 $) [1];

sub new {
    my ( $Type, %Param ) = @_;

    # allocate new hash for object
    my $Self = {};
    bless ($Self, $Type);

    $Self->{Debug} = $Param{Debug} || 0;

    # get needed objects
    for (qw(ConfigObject EncodeObject LogObject DBObject)) {
        $Self->{$_} = $Param{$_} || die "Got no $_!";
    }

    return $Self;
}

sub Run {
    my ( $Self, %Param ) = @_;
    # get config options
    my %Config = ();
    my %Match = ();
    my %Set = ();
    if ($Param{JobConfig} &amp;&amp; ref($Param{JobConfig}) eq 'HASH') {
        %Config = %{$Param{JobConfig}};
        if ($Config{Match}) {
            %Match = %{$Config{Match}};
        }
        if ($Config{Set}) {
            %Set = %{$Config{Set}};
        }
    }
    # match 'Match => ???' stuff
    my $Matched = '';
    my $MatchedNot = 0;
    for (sort keys %Match) {
        if ($Param{GetParam}->{$_} &amp;&amp; $Param{GetParam}->{$_} =~ /$Match{$_}/i) {
            $Matched = $1 || '1';
            if ($Self->{Debug} > 1) {
                $Self->{LogObject}->Log(
                    Priority => 'debug',
                    Message => "'$Param{GetParam}->{$_}' =~ /$Match{$_}/i matched!",
                );
            }
        }
        else {
            $MatchedNot = 1;
            if ($Self->{Debug} > 1) {
                $Self->{LogObject}->Log(
                    Priority => 'debug',
                    Message => "'$Param{GetParam}->{$_}' =~ /$Match{$_}/i matched NOT!",
                );
            }
        }
    }
    # should I ignore the incoming mail?
    if ($Matched &amp;&amp; !$MatchedNot) {
        for (keys %Set) {
            if ($Set{$_} =~ /\[\*\*\*\]/i) {
                $Set{$_} = $Matched;
            }
            $Param{GetParam}->{$_} = $Set{$_};
            $Self->{LogObject}->Log(
                Priority => 'notice',
                Message => "Set param '$_' to '$Set{$_}' (Message-ID: $Param{GetParam}->{'Message-ID'}) ",
            );
        }
    }

    return 1;
}

1;
            ]]></programlisting>
            </para>
            <para>
The following image shows you the email processing flow.
            <screenshot>
            <graphic srccredit="" scale="60" fileref="screenshots/email-processing.png"></graphic>
            </screenshot>
            </para>
        </section>
        <section id="ticket-module-menu">
            <title>Ticket Menu Module</title>
            <para>
To add links in the ticket menu, just use ticket menu modules.
            </para>
            <para>
If you want to create your own ticket menu link, just create your own module.
These modules are located under "Kernel/Output/HTML/TicketMenu*.pm".
For default modules see the admin manual. You just need two functions:
new() and Run():
            </para>
            <para>
The following example shows you how to show a lock or a unlock ticket link.
            </para>
            <para>
Kernel/Config.pm:
            </para>
            <para>
            <programlisting><![CDATA[
# for ticket zoom menu
$Self->{'Ticket::Frontend::MenuModule'}->{'100-Lock'} =  {
    Action => 'AgentTicketLock',
    Module => 'Kernel::Output::HTML::TicketMenuLock',
    Name   => 'Lock'
};

# for ticket preview menu
$Self->{'Ticket::Frontend::PreMenuModule'}->{'100-Lock'} =  {
    Action => 'AgentTicketLock',
    Module => 'Kernel::Output::HTML::TicketMenuLock',
    Name   => 'Lock'
};
            ]]></programlisting>
            </para>
            <para>
Format:
            </para>
            <para>
            <programlisting><![CDATA[
# --
# Kernel/Output/HTML/TicketMenuLock.pm
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::Output::HTML::TicketMenuLock;

use strict;
use warnings;

use vars qw(@ISA $VERSION);
$VERSION = qw($Revision: 1.37 $) [1];

# --
sub new {
    my ( $Type, %Param ) = @_;

    # allocate new hash for object
    my $Self = {};
    bless ($Self, $Type);

    # get needed objects
    for (qw(ConfigObject LogObject DBObject LayoutObject UserID TicketObject)) {
        $Self->{$_} = $Param{$_} || die "Got no $_!";
    }

    return $Self;
}
# --
sub Run {
    my ( $Self, %Param ) = @_;
    # check needed stuff
    if (!$Param{Ticket}) {
        $Self->{LogObject}->Log(Priority => 'error', Message => 'Need Ticket!');
        return;
    }

    # check permission
    if ($Self->{TicketObject}->LockIsTicketLocked(TicketID => $Param{TicketID})) {
        my $AccessOk = $Self->{TicketObject}->OwnerCheck(
            TicketID => $Param{TicketID},
            OwnerID => $Self->{UserID},
        );
        if (!$AccessOk) {
            return $Param{Counter};
        }
    }

    $Self->{LayoutObject}->Block(
        Name => 'Menu',
        Data => { },
    );
    if ($Param{Counter}) {
        $Self->{LayoutObject}->Block(
            Name => 'MenuItemSplit',
            Data => {  },
        );
    }
    if ($Param{Ticket}->{Lock} eq 'lock') {
        $Self->{LayoutObject}->Block(
            Name => 'MenuItem',
            Data => {
                %{$Param{Config}},
                %{$Param{Ticket}},
                %Param,
                Name => 'Unlock',
                Description => 'Unlock to give it back to the queue!',
                Link => 'Action=AgentTicketLock&amp;Subaction=Unlock&amp;TicketID=$QData{"TicketID"}',
            },
        );
    }
    else {
        $Self->{LayoutObject}->Block(
            Name => 'MenuItem',
            Data => {
                %{$Param{Config}},
                %Param,
                Name => 'Lock',
                Description => 'Lock it to work on it!',
                Link => 'Action=AgentTicketLock&amp;Subaction=Lock&amp;TicketID=$QData{"TicketID"}',
            },
        );
    }
    $Param{Counter}++;
    return $Param{Counter};
}
# --
1;
            ]]></programlisting>
            </para>
        </section>
        <section id="ticket-module-event">
            <title>Ticket Event Module</title>
            <para>
To do some actions on ticket events, just write your own ticket event module.
            </para>
            <para>
These modules are located under "Kernel/System/Ticket/Event/*.pm".
For default modules see the admin manual. You just need two functions:
new() and Run():
            </para>
            <para>
The following example shows you how to unlock a ticket after a move action.
            </para>
            <para>
Kernel/Config.pm:
            </para>
            <para>
            <programlisting><![CDATA[
$Self->{'Ticket::EventModulePost'}->{'99-ForceUnlockOnMove'} =  {
    Module => 'Kernel::System::Ticket::Event::ForceUnlock'
};
            ]]></programlisting>
            </para>
            <para>
Format:
            </para>
            <para>
            <programlisting><![CDATA[
# --
# Kernel/System/Ticket/Event/ForceUnlook.pm - unlock ticket
# Copyright (C) (year) (name of author) (email of author)
# --
# $Id: module-format.xml,v 1.37 2010-05-10 15:49:41 mae Exp $
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file COPYING for license information (AGPL). If you
# did not receive this file, see http://www.gnu.org/licenses/agpl.txt.
# --

package Kernel::System::Ticket::Event::ForceUnlock;

use strict;
use warnings;

use vars qw(@ISA $VERSION);
$VERSION = qw($Revision: 1.37 $) [1];

# --
sub new {
    my ( $Type, %Param ) = @_;

    # allocate new hash for object
    my $Self = {};
    bless ($Self, $Type);

    # get needed objects
    for (qw(ConfigObject TicketObject LogObject)) {
        $Self->{$_} = $Param{$_} || die "Got no $_!";
    }

    return $Self;
}
# --
sub Run {
    my ( $Self, %Param ) = @_;

    # check needed stuff
    for (qw(TicketID Event Config)) {
        if (!$Param{$_}) {
            $Self->{LogObject}->Log(Priority => 'error', Message => "Need $_!");
            return;
        }
    }
    if ($Param{Event} eq 'MoveTicket') {
        $Self->{TicketObject}->LockSet(
            TicketID => $Param{TicketID},
            Lock => 'unlock',
            SendNoNotification => 1,
            UserID => 1,
        );
    }
    return 1;
}
# --
1;
            ]]></programlisting>
            </para>
            <para>
Ticket Events for OTRS 2.0:
TicketCreate, TicketDelete, TicketTitleUpdate, TicketUnlockTimeoutUpdate,
TicketEscalationStartUpdate, MoveTicket,
SetCustomerData, TicketFreeTextSet, TicketFreeTimeSet,
TicketPendingTimeSet, LockSet,
StateSet, OwnerSet,
TicketResponsibleUpdate, PrioritySet, HistoryAdd,
HistoryDelete, TicketAccountTime, TicketMerge, ArticleCreate,
ArticleFreeTextSet, ArticleUpdate, ArticleSend,
ArticleBounce, SendAgentNotification,
SendCustomerNotification, SendAutoResponse, ArticleFlagSet;
            </para>
            <para>
Ticket Events for OTRS 2.1 and higher:
TicketCreate, TicketDelete, TicketTitleUpdate, TicketUnlockTimeoutUpdate,
TicketEscalationStartUpdate, TicketQueueUpdate (MoveTicket),
TicketCustomerUpdate (SetCustomerData), TicketFreeTextUpdate
(TicketFreeTextSet), TicketFreeTimeUpdate (TicketFreeTimeSet),
TicketPendingTimeUpdate (TicketPendingTimeSet), TicketLockUpdate (LockSet),
TicketStateUpdate (StateSet), TicketOwnerUpdate (OwnerSet),
TicketResponsibleUpdate, TicketPriorityUpdate (PrioritySet),
TicketSubscribe, TicketUnsubscribe, HistoryAdd,
HistoryDelete, TicketAccountTime, TicketMerge, ArticleCreate,
ArticleFreeTextUpdate (ArticleFreeTextSet), ArticleUpdate, ArticleSend,
ArticleBounce, ArticleAgentNotification, (SendAgentNotification),
ArticleCustomerNotification (SendCustomerNotification), ArticleAutoResponse
(SendAutoResponse), ArticleFlagSet, ArticleFlagDelete;
            </para>
        </section>
        <section id="more-modules">
            <title>More Modules</title>
            <para>
The Agent Ticket Permission Modules (Kernel/System/Ticket/Permission/) contain functions to verify
an agent's authorisation to access a ticket.
            </para>
            <para>
The Customer Ticket Permission Modules (Kernel/System/Ticket/CustomerPermission/) contain functions
to verify a customer's authorisation to access a ticket.
            </para>
            <para>
The Article Module (Kernel/System/Ticket/Article.pm) facilitates the readout and generating of ticket articles.
            </para>
            <para>
More modules and their descriptions are listed under <ulink url="http://dev.otrs.org/">http://dev.otrs.org/</ulink>
            </para>
        </section>
    </section>
    </section>
</chapter>
