<?xml version='1.0' encoding='ISO-8859-1'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
<!-- $Id: package-building.xml,v 1.15 2006-02-24 08:53:10 rk Exp $ -->

<chapter>
    <title>Package Building</title>
    <para>
        If you want to create an OPM package (.opm) you need to create a spec file (.sopm)
        which includes the properties of the package.
    </para>
    <sect1 id="package-spec-file">
        <title>Package Spec File</title>
        <para>
            The OPM package is XML based. You can create/edit the .sopm via a text or xml
            editor. It contains meta data, a file list and database options.
        </para>
        <sect2 id="package-name">
            <title>Name</title>
            <para>The package name (required).</para>
            <programlisting format="linespecific">
&lt;Name&gt;Calendar&lt;/Name&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-version">
            <title>Version</title>
            <para>The package version (required).</para>
            <programlisting format="linespecific">
&lt;Version&gt;1.2.3&lt;/Version&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-framework">
            <title>Framework</title>
            <para>The required framework version (2.0.x means e.g. 2.0.1 or 2.0.9) (required).</para>
            <programlisting format="linespecific">
&lt;Framework&gt;2.0.x&lt;/Framework&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-vendor">
            <title>Vendor</title>
            <para>The package vendor (required).</para>
            <programlisting format="linespecific">
&lt;Vendor&gt;OTRS GmbH&lt;/Vendor&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-url">
            <title>URL</title>
            <para>The vendor URL (required).</para>
            <programlisting format="linespecific">
&lt;URL&gt;http://otrs.org/&lt;/URL&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-license">
            <title>License</title>
            <para>The license of the package (required).</para>
            <programlisting format="linespecific">
&lt;License&gt;GNU GENERAL PUBLIC LICENSE Version 2, June 1991&lt;/License&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-changelog">
            <title>ChangeLog</title>
            <para>The package change log (optional).</para>
            <programlisting format="linespecific">
&lt;ChangeLog&gt;2005-12-02 added change log&lt;/ChangeLog&gt;
&lt;ChangeLog&gt;2005-12-02 v1.1 New package&lt;/ChangeLog&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-description">
            <title>Description</title>
            <para>The package description in different languages (required).</para>
            <programlisting format="linespecific">
&lt;Description Lang="en"&gt;A web calendar.&lt;/Description&gt;
&lt;Description Lang="de"&gt;Ein Web Kalender.&lt;/Description&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-buildhost">
            <title>BuildHost</title>
            <para>This will be filled in automatically by OPM (auto).</para>
            <programlisting format="linespecific">
&lt;BuildHost&gt;?&lt;/BuildHost&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-builddate">
            <title>BuildDate</title>
            <para>This will be filled in automatically by OPM (auto).</para>
            <programlisting format="linespecific">
&lt;BuildDate&gt;?&lt;/BuildDate&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-package-required">
            <title>PackageRequired</title>
            <para>Packages that must be installed beforehand (optional).</para>
            <programlisting format="linespecific">
&lt;PackageRequired Version="1.0.3"&gt;SomeOtherPackage&lt;/PackageRequired&gt;
&lt;PackageRequired Version="5.3.2"&gt;SomeotherPackage2&lt;/PackageRequired&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-os">
            <title>OS (^M)</title>
            <para>Required OS (optional).</para>
            <programlisting format="linespecific">
&lt;OS&gt;Linux&lt;/OS&gt;
&lt;OS&gt;MacOS&lt;/OS&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-filelist">
            <title>Filelist</title>
            <para>
                This is a list of files included in the package (optional).
            </para>
            <programlisting format="linespecific">
&lt;Filelist&gt;
    &lt;File Permission="644" Location="Kernel/Config/Files/Calendar.pm"&gt;&lt;/File&gt;
    &lt;File Permission="644" Location="Kernel/System/CalendarEvent.pm"&gt;&lt;/File&gt;
    &lt;File Permission="644" Location="Kernel/Modules/AgentCalendar.pm"&gt;&lt;/File&gt;
    &lt;File Permission="644" Location="Kernel/Language/de_AgentCalendar.pm"&gt;&lt;/File&gt;
&lt;/Filelist&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-database-install">
            <title>DatabaseInstall</title>
            <para>
               Databases that must be created when the package is installed (optional).
            </para>
            <programlisting format="linespecific">
&lt;DatabaseInstall&gt;
    &lt;TableCreate Name="calendar_event"&gt;
    &lt;Column Name="id" Required="true" PrimaryKey="true" AutoIncrement="true" Type="BIGINT"/&gt;
    &lt;Column Name="title" Required="true" Size="250" Type="VARCHAR"/&gt;
    &lt;Column Name="content" Required="false" Size="250" Type="VARCHAR"/&gt;
    &lt;Column Name="start_time" Required="true" Type="DATE"/&gt;
    &lt;Column Name="end_time" Required="true" Type="DATE"/&gt;
    &lt;Column Name="owner_id" Required="true" Type="INTEGER"/&gt;
    &lt;Column Name="event_status" Required="true" Size="50" Type="VARCHAR"/&gt;
    &lt;/TableCreate&gt;
&lt;/DatabaseInstall&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-database-upgrade">
            <title>DatabaseUpgrade</title>
            <para>
                Information on which actions have to be performed in case of an upgrade (subject to version tag), (optional).
                Example (if installed package version is below 1.3.4, defined action will be performed):
            </para>
            <programlisting format="linespecific">
&lt;DatabaseUpgrade Version="1.3.4"&gt;
    &lt;TableCreate Name="calendar_event_involved" Version="1.3.4"&gt;
        &lt;Column Name="event_id" Required="true" Type="BIGINT"/&gt;
        &lt;Column Name="user_id" Required="true" Type="INTEGER"/&gt;
    &lt;/TableCreate&gt;
&lt;/DatabaseUpgrade&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-database-reinstall">
            <title>DatabaseReinstall</title>
            <para>
                Information on what actions have to be performed if  the package is reinstalled, (optional).
            </para>
            <programlisting format="linespecific">
&lt;DatabaseReinstall&gt;&lt;/DatabaseReinstall&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-database-uninstall">
            <title>DatabaseUninstall</title>
            <para>
                Uninstall (if a package gets uninstalled), (optional).
            </para>
            <programlisting format="linespecific">
&lt;DatabaseUninstall&gt;
    &lt;TableDrop Name="calendar_event" /&gt;
&lt;/DatabaseUninstall&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-code-install">
            <title>CodeInstall</title>
            <para>
To execute perl code if the package is installed (optional).
            </para>
            <programlisting format="linespecific">
&lt;CodeInstall&gt;
    # example
    if (1) {
        print STDERR "Some info to STDERR\n";
    }
    # log example
    $Self-&gt;{LogObject}-&gt;Log(
        Priority =&gt; 'notice',
        Message =&gt; "Some Message!",
    )
    # database example
    $Self-&gt;{DBObject}-&gt;Do(SQL =&gt; "SOME SQL");
&lt;/CodeInstall&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-code-uninstall">
            <title>CodeUninstall</title>
            <para>
To execute perl code if the package is uninstalled (optional).
            </para>
            <programlisting format="linespecific">
&lt;CodeUninstall&gt;
    # example
    if (1) {
        print STDERR "Some info to STDERR\n";
    }
&lt;/CodeUninstall&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-code-reinstall">
            <title>CodeReinstall</title>
            <para>
To execute perl code if the package is reinstalled (optional).
            </para>
            <programlisting format="linespecific">
&lt;CodeReinstall&gt;
    # example
    if (1) {
        print STDERR "Some info to STDERR\n";
    }
&lt;/CodeReinstall&gt;
            </programlisting>
        </sect2>
        <sect2 id="package-code-upgrade">
            <title>CodeUpgrade</title>
            <para>
To execute perl code if the package is upgraded (optional).
            </para>
            <programlisting format="linespecific">
&lt;CodeUpgrade&gt;
    # example
    if (1) {
        print STDERR "Some info to STDERR\n";
    }
&lt;/CodeUpgrade&gt;
            </programlisting>
        </sect2>
    </sect1>
    <sect1 id="package-example-sopm">
        <title>Example .sopm</title>
        <para>
This is a whole example spec file.
        </para>
        <programlisting format="linespecific">
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;otrs_package version="1.0"&gt;
    &lt;Name&gt;Calendar&lt;/Name&gt;
    &lt;Version&gt;0.0.1&lt;/Version&gt;
    &lt;Framework&gt;2.0.x&lt;/Framework&gt;
    &lt;Vendor&gt;OTRS GmbH&lt;/Vendor&gt;
    &lt;URL&gt;http://otrs.org/&lt;/URL&gt;
    &lt;License&gt;GNU GENERAL PUBLIC LICENSE Version 2, June 1991&lt;/License&gt;
    &lt;ChangeLog&gt;2005-12-02 added change log&lt;/ChangeLog&gt;
    &lt;ChangeLog&gt;2005-12-02 v1.1 New package&lt;/ChangeLog&gt;
    &lt;Description Lang="en"&gt;A web calendar.&lt;/Description&gt;
    &lt;Description Lang="de"&gt;Ein Web Kalender.&lt;/Description&gt;
    &lt;BuildDate&gt;?&lt;/BuildDate&gt;
    &lt;BuildHost&gt;?&lt;/BuildHost&gt;
    &lt;Filelist&gt;
        &lt;File Permission="644" Location="Kernel/Config/Files/Calendar.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/System/CalendarEvent.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/Modules/AgentCalendar.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/Language/de_AgentCalendar.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/Output/HTML/Standard/AgentCalendar.dtl"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/Output/HTML/NotificationCalendar.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="var/httpd/htdocs/images/Standard/calendar.png"&gt;&lt;/File&gt;
    &lt;/Filelist&gt;
    &lt;DatabaseInstall&gt;
        &lt;TableCreate Name="calendar_event"&gt;
            &lt;Column Name="id" Required="true" PrimaryKey="true" AutoIncrement="true" Type="BIGINT"/&gt;
            &lt;Column Name="title" Required="true" Size="250" Type="VARCHAR"/&gt;
            &lt;Column Name="content" Required="false" Size="250" Type="VARCHAR"/&gt;
            &lt;Column Name="start_time" Required="true" Type="DATE"/&gt;
            &lt;Column Name="end_time" Required="true" Type="DATE"/&gt;
            &lt;Column Name="owner_id" Required="true" Type="INTEGER"/&gt;
            &lt;Column Name="event_status" Required="true" Size="50" Type="VARCHAR"/&gt;
        &lt;/TableCreate&gt;
    &lt;/DatabaseInstall&gt;
    &lt;DatabaseReinstall&gt;&lt;/DatabaseReinstall&gt;
    &lt;DatabaseUninstall&gt;
        &lt;TableDrop Name="calendar_event"/&gt;
    &lt;/DatabaseUninstall&gt;
&lt;/otrs_package&gt;
        </programlisting>
    </sect1>
    <sect1 id="package-build">
        <title>Package Build</title>
        <para>
To build an .opm package from the spec opm.
        </para>
        <screen>
            shell&gt; bin/opm.pl -a build -p /path/to/example.sopm
            writing /tmp/example-0.0.1.opm
            shell&gt;
        </screen>
    </sect1>
</chapter>
