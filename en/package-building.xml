<?xml version='1.0' encoding='ISO-8859-1'?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.2//EN" "http://www.oasis-open.org/docbook/xml/4.2/docbookx.dtd">
<!-- $Id: package-building.xml,v 1.6 2005-09-05 11:11:43 rk Exp $ -->

<chapter>
    <title>Package Building</title>
    <para>
        If you want to create a own OPM package (.opm) you need to create a spec file (.sopm)
        which includes necessary properties of the package. After that you need to build it
        to get a OPM package.
    </para>
    <sect1 id="package-spec-file">
        <title>Package Spec File</title>
        <para>
            The OPM package is XML based. So you can create/edit the .sopm via a text or xml
            editor. It contains meta data, a file list and database options.
        </para>
        <sect2 id="meta-data">
            <title>Meta Data</title>
            <itemizedlist mark="round" >
                <listitem>
                    <para>Name</para>
                    <para>The package name.</para>
                    <programlisting format="linespecific">
&lt;Name&gt;Calendar&lt;/Name&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>Version</para>
                    <para>The package version.</para>
                    <programlisting format="linespecific">
&lt;Version&gt;1.2&lt;/Version&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>Framework</para>
                    <para>The required framework version (2.0.x means e.g. 2.0.1 or 2.0.9).</para>
                    <programlisting format="linespecific">
&lt;Framework&gt;2.0.x&lt;/Framework&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>Vendor</para>
                    <para>The package vendor.</para>
                    <programlisting format="linespecific">
&lt;Vendor&gt;OTRS GmbH&lt;/Vendor&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>URL</para>
                    <para>The vendor URL.</para>
                    <programlisting format="linespecific">
&lt;URL&gt;http://otrs.org/&lt;/URL&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>License</para>
                    <para>The license of the package.</para>
                    <programlisting format="linespecific">
&lt;License&gt;GNU GENERAL PUBLIC LICENSE Version 2, June 1991&lt;/License&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>ChangeLog</para>
                    <para>The package change log.</para>
                    <programlisting format="linespecific">
&lt;ChangeLog&gt;2005-12-02 added change log&lt;/ChangeLog&gt;
&lt;ChangeLog&gt;2005-12-02 v1.1 New package&lt;/ChangeLog&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>Description</para>
                    <para>The package description in different languages.</para>
                    <programlisting format="linespecific">
&lt;Description Lang="en"&gt;A web calendar.&lt;/Description&gt;
&lt;Description Lang="de"&gt;Ein Web Kalender.&lt;/Description&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>BuildHost</para>
                    <para>This will be filled up automatically by OPM.</para>
                    <programlisting format="linespecific">
&lt;BuildHost&gt;?&lt;/BuildHost&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>BuildDate</para>
                    <para>This will be filled up automatically by OPM.</para>
                    <programlisting format="linespecific">
&lt;BuildDate&gt;?&lt;/BuildDate&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>Required</para>
                    <para>Required modules needs to be installed before.</para>
                    <programlisting format="linespecific">
&lt;Required&gt;SomeOtherPackage&lt;/Required&gt;
&lt;Required&gt;SomeotherPackage2&lt;/Required&gt;
                    </programlisting>
                </listitem>
                <listitem>
                    <para>OS (^M)</para>
                    <para>Required OS.</para>
                    <programlisting format="linespecific">
&lt;OS&gt;Linux&lt;/OS&gt;
&lt;OS&gt;MacOS&lt;/OS&gt;
                    </programlisting>
                </listitem>
            </itemizedlist>
        </sect2>
        <sect2 id="filelist">
            <title>Filelist</title>
            <para>
                This is a file of included file of the package.
            </para>
            <programlisting format="linespecific">
&lt;Filelist&gt;
    &lt;File Permission="644" Location="Kernel/Config/Files/Calendar.pm"&gt;&lt;/File&gt;
    &lt;File Permission="644" Location="Kernel/System/CalendarEvent.pm"&gt;&lt;/File&gt;
    &lt;File Permission="644" Location="Kernel/Modules/AgentCalendar.pm"&gt;&lt;/File&gt;
    &lt;File Permission="644" Location="Kernel/Language/de_AgentCalendar.pm"&gt;&lt;/File&gt;
&lt;/Filelist&gt;
            </programlisting>
        </sect2>
        <sect2 id="database2">
            <title>Database</title>
            <para>
                Install (if a package get installed)
            </para>
            <programlisting format="linespecific">
&lt;DatabaseInstall&gt;
    &lt;TableCreate Name="calendar_event"&gt;
    &lt;Column Name="id" Required="true" PrimaryKey="true" AutoIncrement="true" Type="BIGINT"/&gt;
    &lt;Column Name="title" Required="true" Size="250" Type="VARCHAR"/&gt;
    &lt;Column Name="content" Required="false" Size="250" Type="VARCHAR"/&gt;
    &lt;Column Name="start_time" Required="true" Type="DATE"/&gt;
    &lt;Column Name="end_time" Required="true" Type="DATE"/&gt;
    &lt;Column Name="owner_id" Required="true" Type="INTEGER"/&gt;
    &lt;Column Name="event_status" Required="true" Size="50" Type="VARCHAR"/&gt;
    &lt;/TableCreate&gt;
&lt;/DatabaseInstall&gt;
            </programlisting>
            <para>
                Upgrade (if a package get upgraded, take care of the Version Tag in the
                database actions, this means if the installed package version is below
                1.3.4, then this database action will be preformed)
            </para>
            <programlisting format="linespecific">
&lt;DatabaseUpgrade Version="1.3.4"&gt;
    &lt;TableCreate Name="calendar_event_involved" Version="1.3.4"&gt;
        &lt;Column Name="event_id" Required="true" Type="BIGINT"/&gt;
        &lt;Column Name="user_id" Required="true" Type="INTEGER"/&gt;
    &lt;/TableCreate&gt;
&lt;/DatabaseUpgrade&gt;
            </programlisting>
            <para>
                Reinstall (if a package is installed and get reinstalled)
            </para>
            <programlisting format="linespecific">
&lt;DatabaseReinstall&gt;&lt;/DatabaseReinstall&gt;
            </programlisting>
            <para>
                Uninstall (if a package get uninstalled)
            </para>
            <programlisting format="linespecific">
&lt;DatabaseUninstall&gt;
    &lt;TableDrop Name="calendar_event" /&gt;
&lt;/DatabaseUninstall&gt;
            </programlisting>
        </sect2>
        <sect2 id="example-sopm">
            <title>Example .sopm</title>
            <para>
                This is a whole example spec file.
            </para>
            <programlisting format="linespecific">
&lt;?xml version="1.0" encoding="utf-8" ?&gt;
&lt;otrs_package version="1.0"&gt;
    &lt;Name&gt;Calendar&lt;/Name&gt;
    &lt;Version&gt;1.2&lt;/Version&gt;
    &lt;Framework&gt;2.0.x&lt;/Framework&gt;
    &lt;Vendor&gt;OTRS GmbH&lt;/Vendor&gt;
    &lt;URL&gt;http://otrs.org/&lt;/URL&gt;
    &lt;License&gt;GNU GENERAL PUBLIC LICENSE Version 2, June 1991&lt;/License&gt;
    &lt;ChangeLog&gt;2005-12-02 added change log&lt;/ChangeLog&gt;
    &lt;ChangeLog&gt;2005-12-02 v1.1 New package&lt;/ChangeLog&gt;
    &lt;Description Lang="en"&gt;A web calendar.&lt;/Description&gt;
    &lt;Description Lang="de"&gt;Ein Web Kalender.&lt;/Description&gt;
    &lt;BuildDate&gt;?&lt;/BuildDate&gt;
    &lt;BuildHost&gt;?&lt;/BuildHost&gt;
    &lt;Filelist&gt;
        &lt;File Permission="644" Location="Kernel/Config/Files/Calendar.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/System/CalendarEvent.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/Modules/AgentCalendar.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/Language/de_AgentCalendar.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/Output/HTML/Standard/AgentCalendar.dtl"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="Kernel/Output/HTML/NotificationCalendar.pm"&gt;&lt;/File&gt;
        &lt;File Permission="644" Location="var/httpd/htdocs/images/Standard/calendar.png"&gt;&lt;/File&gt;
    &lt;/Filelist&gt;
    &lt;DatabaseInstall&gt;
        &lt;TableCreate Name="calendar_event"&gt;
            &lt;Column Name="id" Required="true" PrimaryKey="true" AutoIncrement="true" Type="BIGINT"/&gt;
            &lt;Column Name="title" Required="true" Size="250" Type="VARCHAR"/&gt;
            &lt;Column Name="content" Required="false" Size="250" Type="VARCHAR"/&gt;
            &lt;Column Name="start_time" Required="true" Type="DATE"/&gt;
            &lt;Column Name="end_time" Required="true" Type="DATE"/&gt;
            &lt;Column Name="owner_id" Required="true" Type="INTEGER"/&gt;
            &lt;Column Name="event_status" Required="true" Size="50" Type="VARCHAR"/&gt;
        &lt;/TableCreate&gt;
    &lt;/DatabaseInstall&gt;
    &lt;DatabaseReinstall&gt;&lt;/DatabaseReinstall&gt;
    &lt;DatabaseUninstall&gt;
        &lt;TableDrop Name="calendar_event"/&gt;
    &lt;/DatabaseUninstall&gt;
&lt;/otrs_package&gt;
            </programlisting>
        </sect2>
    </sect1>
    <sect1 id="package-build">
        <title>Package Build</title>
        <screen>
            shell&gt; bin/opm.pl -a build -p /path/to/example.sopm
            writing .., /tmp/example-1.0.opm
            shell&gt;
        </screen>
    </sect1>
</chapter>
